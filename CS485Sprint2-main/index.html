<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">

    <script src="https://d3js.org/d3.v6.min.js"></script>
<!--   <script src=-->
<!--        "https://d3js.org/d3.v4.min.js">-->
<!--    </script>-->
<!--    <script src=-->
<!--"https://d3js.org/d3-color.v1.min.js">-->
<!--    </script>-->
<!--    <script src=-->
<!--"https://d3js.org/d3-interpolate.v1.min.js">-->
<!--    </script>-->
<!--    <script src=-->
<!--"https://d3js.org/d3-scale-chromatic.v1.min.js">-->
<!--    </script>-->

    <link href="https://fonts.googleapis.com/css?family=Aldrich|Arima+Madurai|Arvo|Henny+Penny|Indie+Flower|Libre+Baskerville|Pirata+One|Poiret+One|Sancreek|Satisfy|Share+Tech+Mono|Smokum|Snowburst+One|Special+Elite"
          rel="stylesheet">
    <path d="M0,0C27.272727272727273,0,27.272727272727273,-80.78125,54.54545454545455,-80.78125"></path>
</head>
<style type="text/css">

</style>
<body>

<script type="text/javascript">

    // Promise.all([
    //     d3.csv('billionaires1996.csv')
    // ]).then(ready);
    var count = 0
    ready()
    async function ready() {
        //python -m http.server 8888
        var chart = d3.interval(async function () {
            let updatedData =  await preprocess();
            update(updatedData);
        },5000);
    }

      async function preprocess() {
        if(count===0){
            count = count + 1
            var d = await d3.csv('billionaires1996.csv')
            return  d;
        }
        else if (count === 1) {
            count = count + 1
            var d = await d3.csv('billionaires2001.csv')
            return d
        } else if (count === 2) {
            count = count + 1
            var d = await d3.csv('billionaires2014.csv')
            return d

        } else if (count === 3) {
            count = count + 1
            var d = await d3.csv('billionairesCleanedNoColumn.csv')
            return d
        }
    }

    const WIDTH = 1200;
    const HEIGHT = 600;
    const INNER_HEIGHT = HEIGHT - 20;
    const BAR_WIDTH = 60;
    const BAR_GAP = 50;

    const scale = d3.scaleLinear()
        .domain([0, 1000])
        .range([0, INNER_HEIGHT]);

    function y(d) {
        return HEIGHT - scale(d.wealth);
    }

    function height(d) {
        return scale(d.wealth);
    }

    const svg = d3.select("body").append("svg")
        .attr("width", WIDTH)
        .attr("height", HEIGHT)
        .attr("viewBox", [-50, 0, WIDTH, HEIGHT])
        .append("g");

    async function update(data) {
        console.log(data)

        const t = d3.transition()
            .duration(7500);

        const bar = svg.selectAll("g")
            .data(data);

        // EXIT section
        bar
            .exit()
            .remove();

        // UPDATE section
        bar
            .transition(t)
            .attr("transform", (d, i) => `translate(${i * (BAR_WIDTH + BAR_GAP)},${y(d)})`);

        bar.select("rect")
            .transition(t)
            .attr("height", HEIGHT);

        // ENTER section
        const barEnter = bar
            .enter().append("g")
            .attr("transform", (d, i) => `translate(${i * (BAR_WIDTH + BAR_GAP)},${INNER_HEIGHT})`);

        barEnter
            .transition(t)
            .attr("transform", (d, i) => `translate(${i * (BAR_WIDTH + BAR_GAP)},${y(d)})`);
        // D3.schemeTableau10[2]
        var color = d3.scaleOrdinal()
            .range(d3.schemeTableau10);

        const rect = barEnter.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", BAR_WIDTH)
            .attr("height", 0)
            .attr("fill",function(d){
                if(d.industry==="communication"){
                    return d3.schemeTableau10[0]
                }
                else if(d.industry==="entertainment"){
                    return d3.schemeTableau10[1]
                }
                else if(d.industry==="finance"){
                    return d3.schemeTableau10[2]
                }
                else if(d.industry==="medicals"){
                    return d3.schemeTableau10[3]
                }
                else if(d.industry==="raw materials"){
                    return d3.schemeTableau10[4]
                }
                else if(d.industry==="real estate"){
                    return d3.schemeTableau10[5]
                }
                else if(d.industry==="retail"){
                    return d3.schemeTableau10[6]
                }
                else if(d.industry==="service"){
                    return d3.schemeTableau10[7]
                }
                else if(d.industry==="technology"){
                    return d3.schemeTableau10[8]
                }
            });

        rect
            .transition(t)
            .attr("height", height);
        // if(count===0){
        //
        // }
        const text = barEnter.append("text")
            .text(d => d.industry)
            .attr("text-anchor", "middle")
            .attr("dx", BAR_WIDTH / 2)
            .attr("dy", -2);
    }

</script>

</body>
</html>